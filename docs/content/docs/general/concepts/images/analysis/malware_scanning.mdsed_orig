---
title: "Malware Scanning"
linkTitle: "Malware Scanning"
weight: 2
---

## Overview

Anchore Engine now supports the use of the open-source [ClamAV](https://clamav.net) malware scanner to detect malicious code embedded in container images.
This scan occurs only at analysis time when the image content itself is available, and the scan results are available via the Engine API as well as for consumption
in new policy gates to allow gating of image with malware findings.

## Signature DB Updates

Each analyzer service will run a malware signature update before analyzing each image. This does add some latency to the overall analysis time but ensures the signatures
are as up-to-date as possible for each image analyzed. The update behavior can be disabled if you prefer to manage the freshness of the db via another route, such as a shared filesystem
mounted to all analyzer nodes that is updated on a schedule. See the configuration section for details on disabling the db update.

The status of the db update is present in each scan output for each image.


## Scan Results

The `malware` content type is a list of scan results. Each result is the run of a malware scanner, by default `clamav`.

The list of files found to contain malware signature matches is in the `findings` property of each scan result. An empty array value indicates no matches found.

The `metadata` property provides generic metadata specific to the scanner. For the ClamAV implementation, this includes the version data about the signature db used and
if the db update was enabled during the scan. If the db update is disabled, then the `db_version` property of the metadata will not have values since the only way to get
the version metadata is during a db update.

```
{
    "content": [
        {
            "findings": [
                {
                    "path": "/somebadfile",
                    "signature": "Unix.Trojan.MSShellcode-40"
                },
                {
                    "path": "/somedir/somepath/otherbadfile",
                    "signature": "Unix.Trojan.MSShellcode-40"
                }
            ],
            "metadata": {
                "db_update_enabled": true,
                "db_version": {
                    "bytecode": "331",
                    "daily": "25890",
                    "main": "59"
                }
            },
            "scanner": "clamav"
        }
    ],
    "content_type": "malware",
    "imageDigest": "sha256:0eb874fcad5414762a2ca5b2496db5291aad7d3b737700d05e45af43bad3ce4d"
}
```

## Policy Rules

A policy gate called `malware` is available with a `scans` trigger that will fire for each file and signature combination found in the image so that you can fail an evaluation of an image
if malware was detected during the analysis scan.

See [policy checks]({{< ref "/docs/engine/usage/cli_usage/policies/policy_checks" >}}) for more details


